(this["webpackJsonprasa-frontend"]=this["webpackJsonprasa-frontend"]||[]).push([[6],{2301:function(e,t,n){var r=n(415),a=n(2302),c=n(718),i=n(2303),o=c((function(e){var t=r(e,i);return t.length&&t[0]===e[0]?a(t):[]}));e.exports=o},2302:function(e,t,n){var r=n(559),a=n(561),c=n(719),i=n(415),o=n(421),l=n(560),s=Math.min;e.exports=function(e,t,n){for(var u=n?c:a,j=e[0].length,d=e.length,b=d,f=Array(d),h=1/0,O=[];b--;){var v=e[b];b&&t&&(v=i(v,o(t))),h=s(v.length,h),f[b]=!n&&(t||j>=120&&v.length>=120)?new r(b&&v):void 0}v=e[0];var x=-1,g=f[0];e:for(;++x<j&&O.length<h;){var m=v[x],p=t?t(m):m;if(m=n||0!==m?m:0,!(g?l(g,p):u(O,p,n))){for(b=d;--b;){var C=f[b];if(!(C?l(C,p):u(e[b],p,n)))continue e}g&&g.push(p),O.push(m)}}return O}},2303:function(e,t,n){var r=n(720);e.exports=function(e){return r(e)?e:[]}},2304:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="redo",a=[],c="f01e",i="M492 8h-10c-6.627 0-12 5.373-12 12v110.625C426.804 57.047 346.761 7.715 255.207 8.001 118.82 8.428 7.787 120.009 8 256.396 8.214 393.181 119.166 504 256 504c63.926 0 122.202-24.187 166.178-63.908 5.113-4.618 5.354-12.561.482-17.433l-7.069-7.069c-4.503-4.503-11.749-4.714-16.482-.454C361.218 449.238 311.065 470 256 470c-117.744 0-214-95.331-214-214 0-117.744 95.331-214 214-214 82.862 0 154.737 47.077 190.289 116H332c-6.627 0-12 5.373-12 12v10c0 6.627 5.373 12 12 12h160c6.627 0 12-5.373 12-12V20c0-6.627-5.373-12-12-12z";t.definition={prefix:"fal",iconName:r,icon:[512,512,a,c,i]},t.faRedo=t.definition,t.prefix="fal",t.iconName=r,t.width=512,t.height=512,t.ligatures=a,t.unicode=c,t.svgPathData=i},2426:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return le}));var r=n(16),a=n(5),c=n(0),i=n(243),o=n(1126),l=n(261),s=n(2132),u=n(2116),j=n(2301),d=n.n(j),b=n(1),f=n(9),h=n(4),O=n(15),v=n(75),x=n(46),g=n(503),m=n(164),p=n(8),C=n(1123),k=n(20),y=n(2),w=n(2123),R=n(2118),S=n(1130),q=n(210),E=n(2122);function U(e){return null!==e}var D=function(e){return{label:e.role,value:e.role,data:e}};function B(e){var t=e.roles,n=e.value,r=e.onChange,a=Object(b.useMemo)((function(){return t.map(D)}),[t]),i=Object(b.useMemo)((function(){return t.reduce((function(e,t){return Object(y.a)(Object(y.a)({},e),{},{[t.role]:t})}),{})}),[t]),o=(function(e){return e.every((function(e){return"string"===typeof e}))}(n)?n.map((function(e){return i[e]||null})).filter(U):n).map(D);return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(q.a,{variant:"bodySecondary",fontWeight:700,mb:"2",children:"Role"}),Object(c.jsx)(E.a,{placeholder:"Search roles...",fullWidth:!0,items:a,onChange:function(e){Array.isArray(e)&&r(e.map((function(e){return e.data})))},value:o})]})}function I(e){var t=e.user,n=e.onChange,r=e.roles,a=e.lockUsername,i=Object(b.useMemo)((function(){return r.filter((function(e){return e.is_default}))}),[r]);return Object(b.useEffect)((function(){0===t.roles.length&&i.length>0&&n(Object(y.a)(Object(y.a)({},t),{},{roles:i.map((function(e){return e.role}))}))}),[n,t,i]),Object(c.jsxs)(w.a,{spacing:24,variant:"column",alignItems:"stretch",children:[Object(c.jsx)(R.a,{text:"Name",children:Object(c.jsx)(S.a,{value:t.fullname,onChangeValue:function(e){return n(Object(y.a)(Object(y.a)({},t),{},{fullname:e}))},fullWidth:!0,placeholder:"Enter name...","data-qa":"edit-user-name",autoFocus:!0})}),Object(c.jsx)(R.a,{text:"Username",children:Object(c.jsx)(S.a,{value:t.username,onChangeValue:function(e){return n(Object(y.a)(Object(y.a)({},t),{},{username:e}))},fullWidth:!0,disabled:a,"data-qa":"edit-user-username",placeholder:"Enter username..."})}),Object(c.jsx)(B,{roles:r,value:t.roles,onChange:function(e){return n(Object(y.a)(Object(y.a)({},t),{},{roles:e.map((function(e){return e.role}))}))}})]})}var M=n(108),A=n.n(M),_=n(100),F=n(146),N=function(e){return A()(_.a,"invite?token=".concat(e.invite_code))};function W(e){var t=e.user;return t.invite_code?Object(c.jsx)(R.a,{text:"Copy this invitation token and share with the user","data-qa":"invite-token",children:Object(c.jsx)(F.a,{tooltipPlacement:"top",children:N(t)})}):null}var H=function(e){var t;switch(null===(t=e.response)||void 0===t?void 0:t.status){case 409:return"User with that username already exists"}return"Unknown error"};function L(e){var t=e.user,n=void 0===t?p.c:t,r=e.open,i=e.onChangeOpen,l=e.roles,s=e.regenerating,u=""===(null===n||void 0===n?void 0:n.username),j=u||s,d=Object(f.c)(),h=Object(f.d)((function(e){return e.users.newUser})),O=Object(f.d)((function(e){return e.users.error})),v=Object(b.useState)(n),g=Object(a.a)(v,2),m=g[0],y=g[1];Object(b.useEffect)((function(){!0===r&&y(n)}),[r,y,n]);var w=Object(b.useCallback)((function(){Object(p.td)(m)&&d(x.j.request(m))}),[m,d]),R=Object(b.useCallback)((function(){d(x.b.request(m))}),[d,m]),S=Object(b.useCallback)((function(){d(x.a())}),[d]),q=Object(b.useCallback)((function(){S(),i(!1)}),[S,i]),E=j&&h?Object(c.jsx)(W,{user:h}):Object(c.jsx)(I,{lockUsername:!u,user:m,onChange:y,roles:l}),U=u?h?"User created!":"Create new user":s?h?"Invitation token regenerated!":"Regenerate invitation token":"Edit user",D=j?h?"Close":"Next":"Save",B=Object(C.b)(Object(c.jsx)(k.a,{minHeight:350,width:600,children:E}),{banner:O?{content:H(O),variant:"error"}:void 0,header:U,onAfterClose:q,footer:Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(o.a,{large:!0,ml:2,onClick:function(){if(j){if(!h)return void R()}else w();q()},variant:"primary",disabled:!Object(p.wd)(m),"aria-label":D,"data-qa":"user-modal-next",children:D}),(!j||!h)&&Object(c.jsx)(o.a,{large:!0,onClick:q,variant:"secondary","aria-label":"Cancel","data-qa":"user-modal-cancel",children:"Cancel"})]})}),M=Object(a.a)(B,2)[1];return Object(b.useEffect)((function(){M(r)}),[r,M]),null}var T=n(1127),P=n(951),V=n(63);function G(e){var t=e.onApply,n=e.onClose,r=e.offset,i=e.visible,l=e.availableRoles,s=e.selectedRoles,u=l.map((function(e){return e.role})),j=b.useState([]),d=Object(a.a)(j,2),f=d[0],h=d[1];b.useEffect((function(){h(s.map((function(e){return e.role})))}),[s]);var O=Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(k.d,{sx:{borderStyle:"solid",borderWidth:"1px 0 1px 0",borderColor:"#e8ebf4",flexGrow:1,height:"406px",overflow:"hidden"},children:Object(c.jsx)(k.a,{sx:{flexGrow:"1"},p:4,children:Object(c.jsx)(P.a,{p:4,name:"Roles",items:u,checkedItems:f,onChange:function(e){return h(e)}})})}),Object(c.jsxs)(k.d,{justifyContent:"flex-end",px:4,py:3,children:[Object(c.jsx)(o.a,{large:!0,onClick:n,variant:"secondary",children:"Cancel"}),Object(c.jsx)(o.a,{large:!0,ml:2,onClick:function(){var e=l.filter((function(e){return f.includes(e.role)}));t(e),n()},children:"Done"})]})]});return Object(c.jsx)(V.a,{popupWidth:"640px",content:O,hideCloseIcon:!0,title:Object(c.jsx)(T.a,{variant:"h2",children:"Filter by"}),offset:r,onClose:n,visible:i})}var J=n(2095);function Q(e){var t=e.onClick,n=e.selectedRole,r=e.availableRoles,a=e.users,i=e.forwardedRef,o=b.useMemo((function(){return r.reduce((function(e,t){return Object(y.a)(Object(y.a)({},e),{},{[t.role]:a.filter((function(e){return e.roles.includes(t.role)})).length})}),{})}),[r,a]);return Object(c.jsxs)(k.a,{marginBottom:4,ref:i,children:[Object(c.jsx)(J.a,{active:"all"===n,label:"All",total:a.length,onChange:function(){return t()},mr:2,cannotBeCancelled:!0}),r.map((function(e){var r=e===n;return Object(c.jsx)(J.a,{active:r,onChange:function(){return t(r?void 0:e)},label:e.role,total:o[e.role],mr:2,cannotBeCancelled:!0},e.role)}))]})}var z=n(2119),K=n(2128),X=n(950),Y=n(557),Z=n(954),$=n(116),ee=n(2304),te=n(60),ne=n(553),re=n(853),ae=n(11),ce=function(e,t){return{visibility:t?"visible":"hidden",[".table-row:hover &.".concat(e)]:{visibility:"visible"}}};function ie(e){var t=e.user,n=e.highlighted,r=e.onDelete,i=e.onEdit,s=e.onRegenerateInvite,u=Object(O.f)(ae.d.Users,ae.a.Create),j=Object(O.f)(ae.d.Users,ae.a.Delete),d=Object(O.f)(ae.d.Users,ae.a.Update),f=t.invite_expiry,h=f&&f<Date.now()/1e3,v=f&&f>Date.now()/1e3,x=Object(ne.b)("Delete",{placement:"top"}),g=Object(ne.b)("Regenerate invitation token",{placement:"top"}),m=Object(ne.b)("Edit",{placement:"top"}),p=Object(re.a)(N(t),{successDuration:1e4}),C=Object(a.a)(p,2),y=C[0],w=C[1],R=Object(ne.b)(y?"Invitation token copied!":"Copy invitation token",{placement:"top"}),S=Object(b.useCallback)((function(){return r([t])}),[r,t]),q=Object(b.useCallback)((function(){return s(t)}),[s,t]),E=Object(b.useCallback)((function(){return i(t)}),[i,t]);return Object(c.jsxs)(k.d,{flexDirection:"row-reverse",mr:-1,className:"user-row-actions",sx:ce("user-row-actions",n),children:[j&&Object(c.jsx)(o.a,{"data-qa":"delete-user",mr:1,variant:"icon",ref:x,onClick:S,children:Object(c.jsx)(l.a,{icon:te.faTrashAlt})}),u&&h&&Object(c.jsx)(o.a,{"data-qa":"regenerate-invitation-token",mr:1,variant:"icon",ref:g,onClick:q,children:Object(c.jsx)(l.a,{icon:ee.faRedo})}),t.invite_code&&v&&Object(c.jsx)(o.a,{variant:"icon",ref:R,onClick:w,children:Object(c.jsx)(l.a,{icon:Z.faCopy})}),d&&Object(c.jsx)(o.a,{"data-qa":"edit-user",mr:1,variant:"icon",ref:m,onClick:E,children:Object(c.jsx)(l.a,{icon:$.faEdit})})]})}function oe(e){var t=e.onChangeSelected,n=e.onDelete,r=e.onEdit,i=e.onLoadMoreRows,o=e.onRegenerateInvite,l=e.selectedUsers,s=e.total,u=e.users,j=b.useState(void 0),d=Object(a.a)(j,2),f=d[0],O=d[1];return Object(c.jsxs)(K.a,{variant:"flattened",rows:u,onLoadMore:i,total:s,setHighlightedRow:O,highlight:f,children:[Object(c.jsx)(X.a,{width:"20%",title:"Name",children:function(e){var n=!!e.invite_expiry,r=l.includes(e);return Object(c.jsxs)(h.Flex,{alignItems:"center",children:[Object(c.jsx)(h.Box,{flex:"0 1 auto",mr:3,children:Object(c.jsx)("label",{children:Object(c.jsx)(Y.b,{checked:r,onChange:function(){return t(e,!r)}})})}),Object(c.jsx)(h.Box,{flex:"1",style:{overflow:"hidden",textOverflow:"ellipsis"},children:Object(c.jsx)(q.a,{variant:n?"faintBodySecondary":"bodySecondary","data-qa":"user-fullname",children:e.fullname||"-"})})]})}}),Object(c.jsx)(X.a,{width:"20%",title:"Username",children:function(e){var t=!!e.invite_expiry;return Object(c.jsx)(h.Box,{paddingTop:2,paddingBottom:2,"data-content":e.username,children:Object(c.jsx)(q.a,{variant:t?"faintBodySecondary":"bodySecondary",children:e.username})})}}),Object(c.jsx)(X.a,{width:"25%",title:"Roles",children:function(e){return Object(c.jsx)(h.Box,{paddingTop:2,paddingBottom:2,children:Object(c.jsx)(z.a,{items:e.roles,limit:2})})}}),Object(c.jsx)(X.a,{width:"15%",dataQA:"user-table-column-invite",children:function(e){var t=e.invite_expiry;return t?Object(c.jsx)(h.Box,{py:2,textAlign:"right",children:t>Date.now()/1e3?Object(c.jsx)(q.a,{variant:"sidenote",children:"Waiting for user to register"}):Object(c.jsx)(q.a,{variant:"error",children:"Invitation token expired"})}):null}}),Object(c.jsx)(X.a,{width:"20%",sx:{pl:7},children:function(e,t){var a=t.highlighted;return Object(c.jsx)(ie,{user:e,highlighted:a,onDelete:n,onRegenerateInvite:o,onEdit:r})}})]})}function le(){var e=Object(O.k)(),t=Object(f.c)(),n=b.useCallback((function(e){return t(x.e.request(e))}),[t]);b.useEffect((function(){t(v.d.request({search:"",offset:0,limit:0}))}),[t]);var j=b.useCallback((function(e){return t(x.i(e))}),[t]),p=Object(f.d)((function(e){return e.users.users})),C=Object(f.d)((function(e){return e.users.searchQuery})),k=Object(f.d)((function(e){return Object.values(e.roles.roles)})),y=Object(O.n)(!1),w=Object(a.a)(y,2),R=w[0],S=w[1],q=b.useState([]),E=Object(a.a)(q,2),U=E[0],D=E[1],B=b.useState([]),I=Object(a.a)(B,2),M=I[0],A=I[1],_=b.useCallback((function(){return A([])}),[]);b.useEffect((function(){e("view:users:loaded")}),[e]),Object(O.a)((function(){return n({search:C,offset:0,limit:20})}),200,[n,C]);var F=b.useCallback((function(e){t(x.e.request({search:"",offset:Math.max(1,e-30),limit:30}))}),[t]),N=b.useCallback((function(e){return"Search ".concat(e," item").concat(1!==e?"s":"")}),[]),W=U.map((function(e){return e.role})),H=U.length>0?Object.values(p).filter((function(e){return d()(e.roles,W).length>0})):p,T=Number(Object.values(p).length),P=Number(H.length),V=b.useCallback((function(e){D(e||[]),_()}),[D,_]),J=Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(o.a,{variant:"headerIcon",onClick:S,active:R,children:Object(c.jsx)(l.a,{icon:i.faSlidersH})}),Object(c.jsx)(G,{onApply:V,onClose:S,visible:R,offset:[-4,-4],availableRoles:k,selectedRoles:U})]}),z=b.useState(!1),K=Object(a.a)(z,2),X=K[0],Y=K[1],Z=b.useState(void 0),$=Object(a.a)(Z,2),ee=$[0],te=$[1],ne=b.useState(!1),re=Object(a.a)(ne,2),ae=re[0],ce=re[1],ie=b.useCallback((function(e){t(x.c.request(e)),_()}),[t,_]),le=b.useCallback((function(){t(x.a()),Y(!1),te(void 0),ce(!0)}),[Y,te,ce,t]),se=b.useCallback((function(e){Y(!1),te(e),ce(!0)}),[Y,te,ce]),ue=b.useCallback((function(e){Y(!0),te(e),ce(!0)}),[Y,te,ce]),je=Object(O.e)(),de=Object(a.a)(je,2),be=de[0],fe=de[1].height;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(L,{roles:k,open:ae,user:ee,regenerating:X,onChangeOpen:ce}),Object(c.jsx)(s.a,{title:"Users",rightContent:Object(c.jsx)(o.a,{variant:"primary","data-qa":"create-user",large:!0,mr:4,onClick:le,children:"Create new user"}),children:Object(c.jsxs)(h.Box,{height:"calc(100% - ".concat(fe,"px)"),children:[Object(c.jsx)(Q,{onClick:function(e){return V(e?[e]:[])},selectedRole:0===U.length?"all":1===U.length?U[0]:"none",availableRoles:k,users:Object.values(p),forwardedRef:be}),Object(c.jsxs)(m.a,{children:[Object(c.jsx)(u.a,{buttons:[J],count:T,filterTablets:Object(c.jsx)(c.Fragment,{}),query:C,label:N,onChange:j,loading:!1}),!!M.length&&Object(c.jsx)(g.a,{label:"user selected",pluralLabel:"users selected",total:M.length,onClearSelection:_,children:Object(c.jsx)(o.a,{onClick:function(){return ie(M)},variant:"inverse",children:"Delete"})}),Object(c.jsx)(oe,{users:Object.values(H),selectedUsers:M,total:P,onEdit:se,onDelete:ie,onLoadMoreRows:F,onChangeSelected:function(e,t){return t?function(e){return A([].concat(Object(r.a)(M),[e]))}(e):function(e){return A(M.filter((function(t){return t!==e})))}(e)},onRegenerateInvite:ue})]})]})})]})}}}]);